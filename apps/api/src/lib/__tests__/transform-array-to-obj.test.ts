import { transformArrayToObject } from "../extract/extraction-service";

const originalSchema = {
  type: "object",
  properties: {
    products: {
      type: "array",
      items: {
        type: "object",
        properties: {
          name: { type: "string" },
          price: { type: "string" },
          description: { type: "string" }
        }
      }
    }
  }
}

describe("transformArrayToObject function", () => {
  it("shoud transform array to object (id: 26)", async () => {
    const res1 = {
      "products": [
        {
          "name": "סיר Neon 1",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        }
      ]
    }

    const res2 = {
      "products": [
        {
          "name": "סיר Neon 2",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        }
      ]
    }

    const res3 = {
      "products": [
        {
          "name": "סיר Neon 3",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        }
      ]
    }

    const res4 = {
      "products": [
        {
          "name": "סיר Neon 4",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        }
      ]
    }

    const res5 = {
      "products": [
        {
          "name": "סיר Neon 5",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        }
      ]
    }

    const res6 = {
      "products": [
        {
          "name": "סיר Neon 6",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        }
      ]
    }

    const res7 = {
      "products": [
        {
          "name": "סיר Neon 7",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        }
      ]
    }

    const results = [res1, res2, res3, res4, res5, res6, res7]

    const multiEntityResult = {
      "products": [
        {
          "name": "סיר Neon 1",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        },
        {
          "name": "סיר Neon 2",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        },
        {
          "name": "סיר Neon 3",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        },
        {
          "name": "סיר Neon 4",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        },
        {
          "name": "סיר Neon 5",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        },
        {
          "name": "סיר Neon 6",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        },
        {
          "name": "סיר Neon 7",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        }
      ]
    }

    expect(await transformArrayToObject(originalSchema, results)).toEqual(multiEntityResult)
  })

  it("should transform array to object (id: 27)", async () => {
    const res1 = {
      "products": [
        {
          "name": "סיר Neon 1",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        }
      ]
    }

    const res3 = { "products": [] }
    const res4 = { "products": null }

    const results = [res1, res3, res4]

    const multiEntityResult = {
      "products": [
        {
          "name": "סיר Neon 1",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        }
      ]
    }

    expect(await transformArrayToObject(originalSchema, results)).toEqual(multiEntityResult)
  })

  it("should transform array to object (id: 27)", async () => {
    const res1 = {
      "products": [
        {
          "name": "סיר Neon 1",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        }
      ]
    }

    const res3 = { "products": [] }
    const res4 = { "products": [{
      "name": "סיר Neon 4",
      "price": "99.90 ₪",
      "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
    }] }

    const results = [res1, res3, res4]

    const multiEntityResult = {
      "products": [
        {
          "name": "סיר Neon 1",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        },
        {
          "name": "סיר Neon 4",
          "price": "99.90 ₪",
          "description": "סיר מסדרת Neon גוף הכלי עשוי אלומיניום להולכת חום מהירה ואחידה ולחיסכון בזמן ואנרגיה סיר בציפוי נון סטיק למניעת הדבקות המזון, לשימוש מופחת בשמן ולניקוי קל ונוח. מתאים לכל סוגי הכיריים, מתאים לאינדוקציה מתאים לשטיפה במדיח. מתאים לשימוש כסיר אורז, סיר פסטה, סיר מרק, סיר למגוון תבשילים. סיר 28 ס”מ | 7.1 ליטר התמונה להמחשה בלבד. הצבע בתמונה עשוי להיות שונה מהמציאות"
        }
      ]
    }

    expect(await transformArrayToObject(originalSchema, results)).toEqual(multiEntityResult)
  })

  it("more complex schema", async () => {
    const originalSchema = {
      type: "object",
      properties: {
        "ecommerce": {
          type: "object",
          properties: {
            "name": { type: "string" },
            "products": {
              type: "array",
              items: {
                type: "object",
                properties: {
                  "name": { type: "string" },
                  "price": { type: "string" },
                  "description": { type: "string" },
                  "categories": {
                    type: "array",
                    items: {
                      type: "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }

    const res1 = {
      "ecommerce": {
        "name": '1',
        "products": [
          {
            "name": "סיר Neon 1",
            "price": "99.90 ₪",
            "description": "",
            "categories": [ "סירים", "something", "else" ]
          }
        ]
      }
    }
    const res2 = {
      "ecommerce": {
        "name": 'keep the first',
        "products": [
          {
            "name": "סיר Neon 2",
            "price": "99.90 ₪",
            "description": "",
            "categories": [ "סירים", "ajkshda", "something", "else" ]
          }
        ]
      }
    }

    const res3 = { "ecommerce": { "products": [] } }
    const res4 = { "ecommerce": { "products": null } }

    const results = [res1, res2, res3, res4]

    const multiEntityResult = {
      "ecommerce": {
        "name": '1',
        "products": [
          {
            "name": "סיר Neon 1",
            "price": "99.90 ₪",
            "description": "",
            "categories": [ "סירים", "something", "else" ]
          },
          {
            "name": "סיר Neon 2",
            "price": "99.90 ₪",
            "description": "",
            "categories": [ "סירים", "ajkshda", "something", "else" ]
          }
        ]
      }
    }

    console.log(await transformArrayToObject(originalSchema, results))

    expect(await transformArrayToObject(originalSchema, results)).toEqual(multiEntityResult)
  })

  it("even more complex schema", async () => {
    const moreComplexSchema = {
      type: "object",
      properties: {
        "name": { type: "string" },
        "description": { type: "string" },
        "products": {
          type: "array",
          items: {
            type: "object",
            properties: {
              "name": { type: "string" },
              "price": { type: "string" },
              "description": { type: "string" }
            }
          }
        },
        categories: {
          type: "array",
          items: {
            type: "string"
          }
        }
      }
    }

    const res1 = {
      "name": '1',
      "description": "description",
      "products": [
        {
            "name": "Neon 1",
            "price": "99.90 ₪",
            "description": "neon 1 product"
          }
        ],
      "categories": [ "something", "else" ]
    }
    
    const res4 = { "products": [] }

    const res2 = {
      "name": 'keep first',
      "description": "description",
      "products": [
        {
            "name": "Neon 2",
            "price": "99.90 ₪",
            "description": "neon 2 product"
          }
        ],
      "categories": ["something" ]
    }

    const res3 = {
      "name": 'keep the first',
      "products": [
        {
          "name": "Neon 3",
          "price": "555.90 ₪",
          "description": "neon 3 product"
        }
      ],
      "categories": [ "hey", "something", "other one" ]
    }

    const res5 = { "products": null }

    const results = [res1, res2, res3]

    const multiEntityResult = {
      "name": '1',
      "description": "description",
      "products": [
        {
          "name": "Neon 1",
          "price": "99.90 ₪",
          "description": "neon 1 product"
        },
        {
          "name": "Neon 2",
          "price": "99.90 ₪",
          "description": "neon 2 product"
        },
        {
          "name": "Neon 3",
          "price": "555.90 ₪",
          "description": "neon 3 product"
        }
      ],
      "categories": [ "something", "else", "hey", "other one" ]
    }

    console.log(multiEntityResult, await transformArrayToObject(moreComplexSchema, results))

    expect(await transformArrayToObject(moreComplexSchema, results)).toEqual(multiEntityResult)
  })
})
